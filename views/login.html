<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta property="qc:admins" content="17376517276230236375" />
        <title>用户登录</title>
        <link rel="stylesheet" type="text/css" href="/css/app.css">
        <script type="text/javascript" src="/js/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    </head>

    <body>
        <div class="login_wrap">
            <div class="login_panel">
                <div class="login_logo"></div>
                <div class="login_logo_text">用户登录</div>
                <div class="login_input_div">
                    <a class="login_tip">请输入密码</a>
                    <input type="text" id="" class="login_input login_username" placeholder="请输入用户名">
                    <input type="text" id="" class="login_input login_password" placeholder="请输入密码">
                </div>
                <input type="button" value="登  录" class="login_button login_in">
                <a href="reg.html" class="login_a_text">注册</a>
                <a href="forget.html" class="login_a_text">忘记密码</a>
                <a class="qqLogin" id="qqLoginBtn" href="https://graph.qq.com/oauth2.0/authorize?client_id=101140406&response_type=token&scope=all&redirect_uri=http://127.0.0.1"></a>
                <a class="qqLoginOut">退出登录</a>
            </div>
        </div>
    </body>
</html>

<script type="text/javascript" src="http://qzonestyle.gtimg.cn/qzone/openapi/qc_loader.js" data-appid="101140406" data-redirecturi="http://127.0.0.1" charset="utf-8"></script>
<script type="text/javascript">
  var socket = io(null);
  socket.on('connectionok', function (data) {
   console.log("连接成功");
  });

  //调用QC.Login方法，指定btnId参数将按钮绑定在容器节点中
  /*QC.Login({
       //btnId：插入按钮的节点id，必选
       btnId:"qqLoginBtn",
       //用户需要确认的scope授权项，可选，默认all
       scope:"all",
       //按钮尺寸，可用值[A_XL| A_L| A_M| A_S|  B_M| B_S| C_S]，可选，默认B_S
       size: "A_XL"
   }, function(reqData, opts){//登录成功
       //根据返回数据，更换按钮显示状态方法
       var dom = document.getElementById(opts['btnId']),
       _logoutTemplate=[
            //头像
            '<span><img src="{figureurl}" class="{size_key}"/></span>',
            //昵称
            '<span>{nickname}</span>',
            //退出
            '<span><a href="javascript:QC.Login.signOut();">退出</a></span>'    
       ].join("");
       dom && (dom.innerHTML = QC.String.format(_logoutTemplate, {
           nickname : QC.String.escHTML(reqData.nickname), //做xss过滤
           figureurl : reqData.figureurl
       }));
   }, function(opts){//注销成功
         alert('QQ登录 注销成功');
   });*/

  //监听QQ是否登录成功
  QC.api("get_user_info", {}).success(function(s){
    console.log(s);
    $.post("/login.do?fff=1",{"d":1},function(data){
      console.log(data);
    })
  }).error(function(f){
    //alert("获取用户信息失败！");
  }).complete(function(c){
    //alert("获取用户信息完成！");
  });

  if(QC.Login.check()){//如果已登录
    QC.Login.getMe(function(openId, accessToken){
        alert(["当前登录用户的", "openId为："+openId, "accessToken为："+accessToken].join("\n"));
    });
  }

  //退出登录
  $(".qqLoginOut").click(function(){
    QC.Login.signOut();
    if(QC.Login.check()){
      alert("注销成功！");
    }
  });
</script>
